/*
 * Code generation for system model 'CouplingSystem'
 *
 * Model                      : CouplingSystem
 * Model version              : 1.2185
 * Simulink Coder version : 9.2 (R2019b) 18-Jul-2019
 *
 * Note that the functions contained in this file are part of a Simulink
 * model, and are not self-contained algorithms.
 */

#include "CouplingSystem_capi.h"
#include "CouplingSystem.h"
#include "CouplingSystem_private.h"

P_CouplingSystem_T CouplingSystem_P = {
  /* Expression: 5
   * Referenced by: '<Root>/Step'
   */
  5.0,

  /* Expression: 1
   * Referenced by: '<Root>/Step'
   */
  1.0,

  /* Expression: 0
   * Referenced by: '<Root>/Step'
   */
  0.0,

  /* Expression: true
   * Referenced by: '<S2>/ForUnitConnection'
   */
  1,

  /* Expression: false
   * Referenced by: '<S61>/ForTrainConnection'
   */
  0,

  /* Start of '<S1>/CoreSubsys' */
  {
    /* Mask Parameter: CompareToConstant_const
     * Referenced by: '<S17>/Constant'
     */
    1.5,

    /* Mask Parameter: CompareToConstant_const_j
     * Referenced by: '<S18>/Constant'
     */
    1.5,

    /* Mask Parameter: CompareToConstant_const_a
     * Referenced by: '<S19>/Constant'
     */
    1.5,

    /* Mask Parameter: CompareToConstant_const_d
     * Referenced by: '<S20>/Constant'
     */
    1.5,

    /* Mask Parameter: CompareToConstant_const_h
     * Referenced by: '<S21>/Constant'
     */
    1.5,

    /* Mask Parameter: CompareToConstant_const_dg
     * Referenced by: '<S22>/Constant'
     */
    1.5,

    /* Mask Parameter: DetectIncrease_vinit
     * Referenced by: '<S29>/Delay Input1'
     */
    0.0,

    /* Mask Parameter: DetectDecrease_vinit
     * Referenced by: '<S32>/Delay Input1'
     */
    0.0,

    /* Mask Parameter: SRLatchSetPriority2_initial_condition
     * Referenced by: '<S24>/Memory'
     */
    0,

    /* Mask Parameter: SRLatchSetPriority1_initial_condition
     * Referenced by: '<S23>/Memory'
     */
    0,

    /* Computed Parameter: CouplerSystemOut_Y0
     * Referenced by: '<S3>/CouplerSystemOut'
     */
    {
      {
        {
          {
            {
              0.0,                     /* MechanicalCouplerState */
              0.0,                     /* PneumaticCouplerState */
              0.0                      /* CouplerDamaged */
            },                         /* PhysicalSignals */

            {
              0.0,                     /* CouplerType */
              0.0,                     /* ReadyToCouple */
              0.0,                     /* MechanicallyCoupled */
              0.0,                     /* CouplerBrakeDemand */
              0.0,                     /* ElectricallyCoupled */
              0.0,                     /* PneumaticallyCoupled */
              false                    /* RescueModeCondition */
            }                          /* CouplingInterface */
          }, {
            {
              0.0,                     /* MechanicalCouplerState */
              0.0,                     /* PneumaticCouplerState */
              0.0                      /* CouplerDamaged */
            },                         /* PhysicalSignals */

            {
              0.0,                     /* CouplerType */
              0.0,                     /* ReadyToCouple */
              0.0,                     /* MechanicallyCoupled */
              0.0,                     /* CouplerBrakeDemand */
              0.0,                     /* ElectricallyCoupled */
              0.0,                     /* PneumaticallyCoupled */
              false                    /* RescueModeCondition */
            }                          /* CouplingInterface */
          } }
        /* Coupler */
      },                               /* Couplers */

      {
        0.0,                           /* MechanicalCouple */
        0.0                            /* MechanicalUncouple */
      },                               /* CouplerAudio */

      {
        0.0,                           /* MechanicalCouplerState */
        0.0                            /* ExternalCoupling */
      },                               /* OutputControlStates */

      {
        0.0,                           /* EPVState */
        0.0,                           /* ElectricalHeadCommand */
        0.0,                           /* MainResPressureOk */

        {
          0.0, 0.0 }
        ,                              /* PneuUncouplingCommand */

        {
          0.0, 0.0 }
        ,                              /* MechUncouplingCommand */

        {
          0.0, 0.0 }
        ,                              /* ElectUncouplingCommand */

        {
          0.0, 0.0 }
        ,                              /* ElectCouplingCommand */

        {
          0.0, 0.0 }
        ,                              /* VehicleOnAnEnd */

        {
          0.0, 0.0 }
        ,                              /* CouplerTypesAcrossUnit */

        {
          {
            0.0,                       /* AutoCouple */
            0.0,                       /* AvailableReady */
            0.0,                       /* OurCoupled */
            0.0,                       /* Uncoupled */
            0.0,                       /* TheirsCoupled */
            0.0,                       /* BothCoupled */
            0.0,                       /* CouplerTypeMatched */
            0.0,                       /* TheirsExtensionRate */
            0.0,                       /* ModelledTrainCouplerType */
            0.0                        /* OtherTrainCouplerType */
          }, {
            0.0,                       /* AutoCouple */
            0.0,                       /* AvailableReady */
            0.0,                       /* OurCoupled */
            0.0,                       /* Uncoupled */
            0.0,                       /* TheirsCoupled */
            0.0,                       /* BothCoupled */
            0.0,                       /* CouplerTypeMatched */
            0.0,                       /* TheirsExtensionRate */
            0.0,                       /* ModelledTrainCouplerType */
            0.0                        /* OtherTrainCouplerType */
          } }
        /* DebugPerCoupler */
      },                               /* Debug */

      {
        {
          0.0,                         /* MechanicalCouplerState */
          0.0,                         /* PneumaticCouplerState */
          0.0                          /* CouplerDamaged */
        }, {
          0.0,                         /* MechanicalCouplerState */
          0.0,                         /* PneumaticCouplerState */
          0.0                          /* CouplerDamaged */
        } }
      ,                                /* PhysicalSignals */
      0.0,                             /* ElectricalTrainConnection */
      0.0,                             /* ElectricalUnitConnection */
      0.0                              /* ElectricalCoupledCabsConnection */
    },

    /* Computed Parameter: Constant_Value
     * Referenced by: '<S5>/Constant'
     */
    {
      {
        {
          {
            {
              0.0,                     /* MechanicalCouplerState */
              0.0,                     /* PneumaticCouplerState */
              0.0                      /* CouplerDamaged */
            },                         /* PhysicalSignals */

            {
              0.0,                     /* CouplerType */
              0.0,                     /* ReadyToCouple */
              0.0,                     /* MechanicallyCoupled */
              0.0,                     /* CouplerBrakeDemand */
              0.0,                     /* ElectricallyCoupled */
              0.0,                     /* PneumaticallyCoupled */
              false                    /* RescueModeCondition */
            }                          /* CouplingInterface */
          }, {
            {
              0.0,                     /* MechanicalCouplerState */
              0.0,                     /* PneumaticCouplerState */
              0.0                      /* CouplerDamaged */
            },                         /* PhysicalSignals */

            {
              0.0,                     /* CouplerType */
              0.0,                     /* ReadyToCouple */
              0.0,                     /* MechanicallyCoupled */
              0.0,                     /* CouplerBrakeDemand */
              0.0,                     /* ElectricallyCoupled */
              0.0,                     /* PneumaticallyCoupled */
              false                    /* RescueModeCondition */
            }                          /* CouplingInterface */
          } }
        /* Coupler */
      },                               /* Couplers */

      {
        0.0,                           /* MechanicalCouple */
        0.0                            /* MechanicalUncouple */
      },                               /* CouplerAudio */

      {
        0.0,                           /* MechanicalCouplerState */
        0.0                            /* ExternalCoupling */
      },                               /* OutputControlStates */

      {
        0.0,                           /* EPVState */
        0.0,                           /* ElectricalHeadCommand */
        0.0,                           /* MainResPressureOk */

        {
          0.0, 0.0 }
        ,                              /* PneuUncouplingCommand */

        {
          0.0, 0.0 }
        ,                              /* MechUncouplingCommand */

        {
          0.0, 0.0 }
        ,                              /* ElectUncouplingCommand */

        {
          0.0, 0.0 }
        ,                              /* ElectCouplingCommand */

        {
          0.0, 0.0 }
        ,                              /* VehicleOnAnEnd */

        {
          0.0, 0.0 }
        ,                              /* CouplerTypesAcrossUnit */

        {
          {
            0.0,                       /* AutoCouple */
            0.0,                       /* AvailableReady */
            0.0,                       /* OurCoupled */
            0.0,                       /* Uncoupled */
            0.0,                       /* TheirsCoupled */
            0.0,                       /* BothCoupled */
            0.0,                       /* CouplerTypeMatched */
            0.0,                       /* TheirsExtensionRate */
            0.0,                       /* ModelledTrainCouplerType */
            0.0                        /* OtherTrainCouplerType */
          }, {
            0.0,                       /* AutoCouple */
            0.0,                       /* AvailableReady */
            0.0,                       /* OurCoupled */
            0.0,                       /* Uncoupled */
            0.0,                       /* TheirsCoupled */
            0.0,                       /* BothCoupled */
            0.0,                       /* CouplerTypeMatched */
            0.0,                       /* TheirsExtensionRate */
            0.0,                       /* ModelledTrainCouplerType */
            0.0                        /* OtherTrainCouplerType */
          } }
        /* DebugPerCoupler */
      },                               /* Debug */

      {
        {
          0.0,                         /* MechanicalCouplerState */
          0.0,                         /* PneumaticCouplerState */
          0.0                          /* CouplerDamaged */
        }, {
          0.0,                         /* MechanicalCouplerState */
          0.0,                         /* PneumaticCouplerState */
          0.0                          /* CouplerDamaged */
        } }
      ,                                /* PhysicalSignals */
      0.0,                             /* ElectricalTrainConnection */
      0.0,                             /* ElectricalUnitConnection */
      0.0                              /* ElectricalCoupledCabsConnection */
    },

    /* Computed Parameter: Constant1_Value
     * Referenced by: '<S60>/Constant1'
     */
    {
      0.0,                             /* EPVState */
      0.0,                             /* ElectricalHeadCommand */
      0.0,                             /* MainResPressureOk */

      {
        0.0, 0.0 }
      ,                                /* PneuUncouplingCommand */

      {
        0.0, 0.0 }
      ,                                /* MechUncouplingCommand */

      {
        0.0, 0.0 }
      ,                                /* ElectUncouplingCommand */

      {
        0.0, 0.0 }
      ,                                /* ElectCouplingCommand */

      {
        0.0, 0.0 }
      ,                                /* VehicleOnAnEnd */

      {
        0.0, 0.0 }
      ,                                /* CouplerTypesAcrossUnit */

      {
        {
          0.0,                         /* AutoCouple */
          0.0,                         /* AvailableReady */
          0.0,                         /* OurCoupled */
          0.0,                         /* Uncoupled */
          0.0,                         /* TheirsCoupled */
          0.0,                         /* BothCoupled */
          0.0,                         /* CouplerTypeMatched */
          0.0,                         /* TheirsExtensionRate */
          0.0,                         /* ModelledTrainCouplerType */
          0.0                          /* OtherTrainCouplerType */
        }, {
          0.0,                         /* AutoCouple */
          0.0,                         /* AvailableReady */
          0.0,                         /* OurCoupled */
          0.0,                         /* Uncoupled */
          0.0,                         /* TheirsCoupled */
          0.0,                         /* BothCoupled */
          0.0,                         /* CouplerTypeMatched */
          0.0,                         /* TheirsExtensionRate */
          0.0,                         /* ModelledTrainCouplerType */
          0.0                          /* OtherTrainCouplerType */
        } }
      /* DebugPerCoupler */
    },

    /* Computed Parameter: UnitDelay_InitialCondition
     * Referenced by: '<S4>/Unit Delay'
     */
    {
      {
        0.0,                           /* MechanicalCouplerState */
        0.0,                           /* PneumaticCouplerState */
        0.0                            /* CouplerDamaged */
      },                               /* PhysicalSignals */

      {
        0.0,                           /* CouplerType */
        0.0,                           /* ReadyToCouple */
        0.0,                           /* MechanicallyCoupled */
        0.0,                           /* CouplerBrakeDemand */
        0.0,                           /* ElectricallyCoupled */
        0.0,                           /* PneumaticallyCoupled */
        false                          /* RescueModeCondition */
      }                                /* CouplingInterface */
    },

    /* Expression: 2
     * Referenced by: '<S10>/Constant1'
     */
    2.0,

    /* Expression: 1
     * Referenced by: '<S10>/Constant'
     */
    1.0,

    /* Expression: 2
     * Referenced by: '<S11>/Constant1'
     */
    2.0,

    /* Expression: 1
     * Referenced by: '<S11>/Constant'
     */
    1.0,

    /* Expression: 2
     * Referenced by: '<S12>/Constant1'
     */
    2.0,

    /* Expression: 1
     * Referenced by: '<S12>/Constant'
     */
    1.0,

    /* Expression: 2
     * Referenced by: '<S13>/Constant1'
     */
    2.0,

    /* Expression: 1
     * Referenced by: '<S13>/Constant'
     */
    1.0,

    /* Expression: 2
     * Referenced by: '<S14>/Constant1'
     */
    2.0,

    /* Expression: 1
     * Referenced by: '<S14>/Constant'
     */
    1.0,

    /* Expression: 2
     * Referenced by: '<S15>/Constant1'
     */
    2.0,

    /* Expression: 1
     * Referenced by: '<S15>/Constant'
     */
    1.0,

    /* Expression: [0 0]
     * Referenced by: '<S6>/Constant1'
     */
    { 0.0, 0.0 },

    /* Expression: 1
     * Referenced by: '<S6>/Temporary_ReadyToCouple'
     */
    1.0,

    /* Expression: [0 0]
     * Referenced by: '<S6>/Constant2'
     */
    { 0.0, 0.0 },

    /* Expression: [0 0]
     * Referenced by: '<S6>/Constant3'
     */
    { 0.0, 0.0 },

    /* Expression: [0 0]
     * Referenced by: '<S6>/Constant4'
     */
    { 0.0, 0.0 },

    /* Expression: 2
     * Referenced by: '<S16>/Saturation'
     */
    2.0,

    /* Expression: 1
     * Referenced by: '<S16>/Saturation'
     */
    1.0,

    /* Expression: [2 2]
     * Referenced by: '<S6>/Constant6'
     */
    { 2.0, 2.0 },

    /* Expression: 1
     * Referenced by: '<S6>/Constant7'
     */
    1.0,

    /* Expression: [0 0]
     * Referenced by: '<S6>/Constant12'
     */
    { 0.0, 0.0 },

    /* Expression: 1
     * Referenced by: '<S16>/Constant'
     */
    1.0,

    /* Expression: [0 0]
     * Referenced by: '<S6>/Constant5'
     */
    { 0.0, 0.0 },

    /* Expression: [0 0]
     * Referenced by: '<S6>/Constant11'
     */
    { 0.0, 0.0 },

    /* Expression: 2
     * Referenced by: '<S8>/Switch2'
     */
    2.0,

    /* Expression: 0
     * Referenced by: '<S26>/Switch3'
     */
    0.0,

    /* Expression: 0
     * Referenced by: '<S27>/Switch3'
     */
    0.0,

    /* Expression: 2
     * Referenced by: '<S8>/Switch1'
     */
    2.0,

    /* Start of '<S9>/CoreSubsys' */
    {
      /* Mask Parameter: TriggerOtherCoupling_UpperSaturationLimit
       * Referenced by: '<S38>/Timer'
       */
      1.0,

      /* Mask Parameter: CloseRange_const
       * Referenced by: '<S44>/Constant'
       */
      0.1,

      /* Mask Parameter: WithinRange_const
       * Referenced by: '<S57>/Constant'
       */
      0.0,

      /* Mask Parameter: WithinRange1_const
       * Referenced by: '<S58>/Constant'
       */
      1.5,

      /* Mask Parameter: MovedAway_const
       * Referenced by: '<S55>/Constant'
       */
      1.5,

      /* Mask Parameter: DetectDecrease_vinit
       * Referenced by: '<S46>/Delay Input1'
       */
      0.0,

      /* Mask Parameter: SRLatchResetPriority_initial_condition
       * Referenced by: '<S52>/Memory'
       */
      0,

      /* Mask Parameter: CoupledState_initial_condition
       * Referenced by: '<S45>/Memory'
       */
      0,

      /* Mask Parameter: Head_initial_condition
       * Referenced by: '<S39>/Memory'
       */
      0,

      /* Mask Parameter: SRR_initial_condition
       * Referenced by: '<S56>/Memory'
       */
      0,

      /* Computed Parameter: Constant_Value
       * Referenced by: '<S50>/Constant'
       */
      {
        0.0,                           /* AutoCouple */
        0.0,                           /* AvailableReady */
        0.0,                           /* OurCoupled */
        0.0,                           /* Uncoupled */
        0.0,                           /* TheirsCoupled */
        0.0,                           /* BothCoupled */
        0.0,                           /* CouplerTypeMatched */
        0.0,                           /* TheirsExtensionRate */
        0.0,                           /* ModelledTrainCouplerType */
        0.0                            /* OtherTrainCouplerType */
      },

      /* Computed Parameter: Constant_Value_k
       * Referenced by: '<S9>/Constant'
       */
      {
        0.0,                           /* CouplerType */
        0.0,                           /* ReadyToCouple */
        0.0,                           /* MechanicallyCoupled */
        0.0,                           /* CouplerBrakeDemand */
        0.0,                           /* ElectricallyCoupled */
        0.0,                           /* PneumaticallyCoupled */
        false                          /* RescueModeCondition */
      },

      /* Computed Parameter: Constant1_Value
       * Referenced by: '<S9>/Constant1'
       */
      {
        0.0,                           /* MechanicalCouplerState */
        0.0,                           /* PneumaticCouplerState */
        0.0                            /* CouplerDamaged */
      },

      /* Expression: 0
       * Referenced by: '<S59>/Constant'
       */
      0.0,

      /* Computed Parameter: Timer_gainval
       * Referenced by: '<S38>/Timer'
       */
      0.05,

      /* Expression: 0
       * Referenced by: '<S38>/Timer'
       */
      0.0,

      /* Expression: 0
       * Referenced by: '<S38>/Timer'
       */
      0.0,

      /* Expression: 0
       * Referenced by: '<S40>/Constant'
       */
      0.0,

      /* Expression: 0
       * Referenced by: '<S53>/Constant'
       */
      0.0,

      /* Expression: 0
       * Referenced by: '<S54>/Constant'
       */
      0.0,

      /* Expression: 0
       * Referenced by: '<S48>/Constant'
       */
      0.0,

      /* Expression: 0.6/3.6
       * Referenced by: '<S37>/MinAutoCouplingSpeed'
       */
      0.16666666666666666,

      /* Expression: -1
       * Referenced by: '<S43>/ApproachSpeed'
       */
      -1.0,

      /* Expression: 5/3.6
       * Referenced by: '<S37>/MaxAutoCouplingSpeed'
       */
      1.3888888888888888,

      /* Expression: 0
       * Referenced by: '<S37>/Switch'
       */
      0.0,

      /* Expression: 0
       * Referenced by: '<S35>/Switch2'
       */
      0.0
    }
    ,

    /* End of '<S9>/CoreSubsys' */

    /* Start of '<S28>/TimerOffDelay NoInit' */
    {
      /* Expression: UpperSaturationLimit
       * Referenced by: '<S33>/OffTime'
       */
      0.5,

      /* Expression: 0
       * Referenced by: '<S34>/Constant'
       */
      0.0,

      /* Expression: -1
       * Referenced by: '<S33>/Gain'
       */
      -1.0,

      /* Expression: 0
       * Referenced by: '<S33>/Initialise'
       */
      0.0,

      /* Expression: 1
       * Referenced by: '<S33>/IC'
       */
      1.0,

      /* Computed Parameter: DiscreteTimeIntegrator_gainval
       * Referenced by: '<S33>/Discrete-Time Integrator'
       */
      0.05,

      /* Expression: UpperSaturationLimit
       * Referenced by: '<S33>/Discrete-Time Integrator'
       */
      0.5,

      /* Expression: 0
       * Referenced by: '<S33>/Discrete-Time Integrator'
       */
      0.0
    }
    ,

    /* End of '<S28>/TimerOffDelay NoInit' */

    /* Start of '<S25>/TimerOffDelay NoInit' */
    {
      /* Expression: UpperSaturationLimit
       * Referenced by: '<S30>/OffTime'
       */
      0.5,

      /* Expression: 0
       * Referenced by: '<S31>/Constant'
       */
      0.0,

      /* Expression: -1
       * Referenced by: '<S30>/Gain'
       */
      -1.0,

      /* Expression: 0
       * Referenced by: '<S30>/Initialise'
       */
      0.0,

      /* Expression: 1
       * Referenced by: '<S30>/IC'
       */
      1.0,

      /* Computed Parameter: DiscreteTimeIntegrator_gainval
       * Referenced by: '<S30>/Discrete-Time Integrator'
       */
      0.05,

      /* Expression: UpperSaturationLimit
       * Referenced by: '<S30>/Discrete-Time Integrator'
       */
      0.5,

      /* Expression: 0
       * Referenced by: '<S30>/Discrete-Time Integrator'
       */
      0.0
    }
    /* End of '<S25>/TimerOffDelay NoInit' */
  }
  /* End of '<S1>/CoreSubsys' */
};

/*
 * System initialize for atomic system:
 *    '<S25>/TimerOffDelay NoInit'
 *    '<S28>/TimerOffDelay NoInit'
 */
void CouplingSystem_TimerOffDelayNoInit_Init
  (DW_TimerOffDelayNoInit_CouplingSystem_T *localDW)
{
  /* InitializeConditions for DiscreteIntegrator: '<S30>/Discrete-Time Integrator' */
  localDW->DiscreteTimeIntegrator_IC_LOADING = 1U;
  localDW->DiscreteTimeIntegrator_PrevResetState = 0;
}

/*
 * Start for atomic system:
 *    '<S25>/TimerOffDelay NoInit'
 *    '<S28>/TimerOffDelay NoInit'
 */
void CouplingSystem_TimerOffDelayNoInit_Start
  (B_TimerOffDelayNoInit_CouplingSystem_T *localB,
   DW_TimerOffDelayNoInit_CouplingSystem_T *localDW)
{
  localDW->DiscreteTimeIntegrator_DSTATE = 0.0;
  localB->LogicalOperator1 = false;

  /* Start for InitialCondition: '<S30>/IC' */
  localDW->IC_FirstOutputTime = true;
}

/*
 * Output and update for atomic system:
 *    '<S25>/TimerOffDelay NoInit'
 *    '<S28>/TimerOffDelay NoInit'
 */
void CouplingSystem_TimerOffDelayNoInit(boolean_T rtu_In,
  B_TimerOffDelayNoInit_CouplingSystem_T *localB,
  DW_TimerOffDelayNoInit_CouplingSystem_T *localDW,
  P_TimerOffDelayNoInit_CouplingSystem_T *localP)
{
  real_T rtb_DiscreteTimeIntegrator_o2;
  real_T DiscreteTimeIntegrator_o1;

  /* InitialCondition: '<S30>/IC' incorporates:
   *  Constant: '<S30>/Initialise'
   */
  if (localDW->IC_FirstOutputTime) {
    localDW->IC_FirstOutputTime = false;
    rtb_DiscreteTimeIntegrator_o2 = localP->IC_Value;
  } else {
    rtb_DiscreteTimeIntegrator_o2 = localP->Initialise_Value;
  }

  /* End of InitialCondition: '<S30>/IC' */

  /* Switch: '<S30>/Switch2' incorporates:
   *  Constant: '<S30>/Initialise'
   *  Constant: '<S30>/OffTime'
   */
  if (rtb_DiscreteTimeIntegrator_o2 != 0.0) {
    rtb_DiscreteTimeIntegrator_o2 = localP->Initialise_Value;
  } else {
    rtb_DiscreteTimeIntegrator_o2 = localP->OffTime_Value;
  }

  /* End of Switch: '<S30>/Switch2' */

  /* DiscreteIntegrator: '<S30>/Discrete-Time Integrator' incorporates:
   *  DataTypeConversion: '<S30>/Data Type Conversion'
   *  Gain: '<S30>/Gain'
   *  Logic: '<S30>/Logical Operator'
   */
  if (localDW->DiscreteTimeIntegrator_IC_LOADING != 0) {
    localDW->DiscreteTimeIntegrator_DSTATE = rtb_DiscreteTimeIntegrator_o2;
    if (localDW->DiscreteTimeIntegrator_DSTATE >=
        localP->DiscreteTimeIntegrator_UpperSat) {
      localDW->DiscreteTimeIntegrator_DSTATE =
        localP->DiscreteTimeIntegrator_UpperSat;
    } else {
      if (localDW->DiscreteTimeIntegrator_DSTATE <=
          localP->DiscreteTimeIntegrator_LowerSat) {
        localDW->DiscreteTimeIntegrator_DSTATE =
          localP->DiscreteTimeIntegrator_LowerSat;
      }
    }
  }

  if (rtu_In || (localDW->DiscreteTimeIntegrator_PrevResetState != 0)) {
    localDW->DiscreteTimeIntegrator_DSTATE = rtb_DiscreteTimeIntegrator_o2;
    if (localDW->DiscreteTimeIntegrator_DSTATE >=
        localP->DiscreteTimeIntegrator_UpperSat) {
      localDW->DiscreteTimeIntegrator_DSTATE =
        localP->DiscreteTimeIntegrator_UpperSat;
    } else {
      if (localDW->DiscreteTimeIntegrator_DSTATE <=
          localP->DiscreteTimeIntegrator_LowerSat) {
        localDW->DiscreteTimeIntegrator_DSTATE =
          localP->DiscreteTimeIntegrator_LowerSat;
      }
    }
  }

  DiscreteTimeIntegrator_o1 = localP->Gain_Gain * static_cast<real_T>(!rtu_In) *
    localP->DiscreteTimeIntegrator_gainval +
    localDW->DiscreteTimeIntegrator_DSTATE;
  if (DiscreteTimeIntegrator_o1 >= localP->DiscreteTimeIntegrator_UpperSat) {
    DiscreteTimeIntegrator_o1 = localP->DiscreteTimeIntegrator_UpperSat;
    rtb_DiscreteTimeIntegrator_o2 = 1.0;
  } else if (DiscreteTimeIntegrator_o1 <=
             localP->DiscreteTimeIntegrator_LowerSat) {
    DiscreteTimeIntegrator_o1 = localP->DiscreteTimeIntegrator_LowerSat;
    rtb_DiscreteTimeIntegrator_o2 = -1.0;
  } else {
    rtb_DiscreteTimeIntegrator_o2 = 0.0;
  }

  /* End of DiscreteIntegrator: '<S30>/Discrete-Time Integrator' */

  /* Logic: '<S30>/Logical Operator1' incorporates:
   *  Constant: '<S31>/Constant'
   *  RelationalOperator: '<S31>/Compare'
   */
  localB->LogicalOperator1 = ((rtb_DiscreteTimeIntegrator_o2 >=
    localP->Constant_Value) || rtu_In);

  /* Update for DiscreteIntegrator: '<S30>/Discrete-Time Integrator' */
  localDW->DiscreteTimeIntegrator_IC_LOADING = 0U;
  localDW->DiscreteTimeIntegrator_DSTATE = DiscreteTimeIntegrator_o1;
  localDW->DiscreteTimeIntegrator_PrevResetState = static_cast<int8_T>(rtu_In);
}

/* System initialize for referenced model: 'CouplingSystem' */
void CouplingSystem_Init(B_CouplingSystem_c_T *localB, DW_CouplingSystem_f_T
  *localDW)
{
  /* local scratch DWork variables */
  int32_T ForEachVehicle_itr_i;
  int32_T ForEachCoupler_itr_e;

  /* SystemInitialize for Iterator SubSystem: '<Root>/CouplingSystemPerCar' */
  for (ForEachVehicle_itr_i = 0; ForEachVehicle_itr_i < 8; ForEachVehicle_itr_i
       ++) {
    /* SystemInitialize for Enabled SubSystem: '<S1>/CouplerSystem' */
    /* InitializeConditions for UnitDelay: '<S4>/Unit Delay' */
    localDW->CoreSubsys[ForEachVehicle_itr_i].UnitDelay_DSTATE[0] =
      CouplingSystem_P.CoreSubsys.UnitDelay_InitialCondition;
    localDW->CoreSubsys[ForEachVehicle_itr_i].UnitDelay_DSTATE[1] =
      CouplingSystem_P.CoreSubsys.UnitDelay_InitialCondition;

    /* InitializeConditions for Memory: '<S24>/Memory' */
    localDW->CoreSubsys[ForEachVehicle_itr_i].Memory_PreviousInput =
      CouplingSystem_P.CoreSubsys.SRLatchSetPriority2_initial_condition;

    /* InitializeConditions for Memory: '<S23>/Memory' */
    localDW->CoreSubsys[ForEachVehicle_itr_i].Memory_PreviousInput_h =
      CouplingSystem_P.CoreSubsys.SRLatchSetPriority1_initial_condition;

    /* SystemInitialize for Iterator SubSystem: '<S4>/PerEachHeadAndTailCouperGeneralCoupling' */
    for (ForEachCoupler_itr_e = 0; ForEachCoupler_itr_e < 2;
         ForEachCoupler_itr_e++) {
      /* InitializeConditions for Memory: '<S52>/Memory' */
      localDW->CoreSubsys[ForEachVehicle_itr_i].CoreSubsys[ForEachCoupler_itr_e]
        .Memory_PreviousInput =
        CouplingSystem_P.CoreSubsys.CoreSubsys.SRLatchResetPriority_initial_condition;

      /* InitializeConditions for Memory: '<S45>/Memory' */
      localDW->CoreSubsys[ForEachVehicle_itr_i].CoreSubsys[ForEachCoupler_itr_e]
        .Memory_PreviousInput_e =
        CouplingSystem_P.CoreSubsys.CoreSubsys.CoupledState_initial_condition;

      /* InitializeConditions for UnitDelay: '<S46>/Delay Input1' */
      localDW->CoreSubsys[ForEachVehicle_itr_i].CoreSubsys[ForEachCoupler_itr_e]
        .DelayInput1_DSTATE =
        CouplingSystem_P.CoreSubsys.CoreSubsys.DetectDecrease_vinit;

      /* InitializeConditions for Memory: '<S39>/Memory' */
      localDW->CoreSubsys[ForEachVehicle_itr_i].CoreSubsys[ForEachCoupler_itr_e]
        .Memory_PreviousInput_g =
        CouplingSystem_P.CoreSubsys.CoreSubsys.Head_initial_condition;

      /* InitializeConditions for Memory: '<S56>/Memory' */
      localDW->CoreSubsys[ForEachVehicle_itr_i].CoreSubsys[ForEachCoupler_itr_e]
        .Memory_PreviousInput_a =
        CouplingSystem_P.CoreSubsys.CoreSubsys.SRR_initial_condition;

      /* SystemInitialize for Atomic SubSystem: '<S9>/TriggerOtherCoupling' */
      /* InitializeConditions for DiscreteIntegrator: '<S38>/Timer' */
      localDW->CoreSubsys[ForEachVehicle_itr_i].CoreSubsys[ForEachCoupler_itr_e]
        .Timer_DSTATE = CouplingSystem_P.CoreSubsys.CoreSubsys.Timer_IC;
      localDW->CoreSubsys[ForEachVehicle_itr_i].CoreSubsys[ForEachCoupler_itr_e]
        .Timer_PrevResetState = 0;

      /* End of SystemInitialize for SubSystem: '<S9>/TriggerOtherCoupling' */
    }

    /* End of SystemInitialize for SubSystem: '<S4>/PerEachHeadAndTailCouperGeneralCoupling' */

    /* SystemInitialize for Atomic SubSystem: '<S8>/LeadingEdgePulse' */
    /* InitializeConditions for UnitDelay: '<S29>/Delay Input1' */
    localDW->CoreSubsys[ForEachVehicle_itr_i].DelayInput1_DSTATE_n =
      CouplingSystem_P.CoreSubsys.DetectIncrease_vinit;

    /* SystemInitialize for Atomic SubSystem: '<S25>/TimerOffDelay NoInit' */
    CouplingSystem_TimerOffDelayNoInit_Init(&localDW->
      CoreSubsys[ForEachVehicle_itr_i].TimerOffDelayNoInit);

    /* End of SystemInitialize for SubSystem: '<S25>/TimerOffDelay NoInit' */
    /* End of SystemInitialize for SubSystem: '<S8>/LeadingEdgePulse' */

    /* SystemInitialize for Atomic SubSystem: '<S8>/TrailingEdgePulse' */
    /* InitializeConditions for UnitDelay: '<S32>/Delay Input1' */
    localDW->CoreSubsys[ForEachVehicle_itr_i].DelayInput1_DSTATE =
      CouplingSystem_P.CoreSubsys.DetectDecrease_vinit;

    /* SystemInitialize for Atomic SubSystem: '<S28>/TimerOffDelay NoInit' */
    CouplingSystem_TimerOffDelayNoInit_Init(&localDW->
      CoreSubsys[ForEachVehicle_itr_i].TimerOffDelayNoInit_f);

    /* End of SystemInitialize for SubSystem: '<S28>/TimerOffDelay NoInit' */
    /* End of SystemInitialize for SubSystem: '<S8>/TrailingEdgePulse' */

    /* SystemInitialize for Outport: '<S3>/CouplerSystemOut' */
    localB->CoreSubsys[ForEachVehicle_itr_i].BusAssignment =
      CouplingSystem_P.CoreSubsys.CouplerSystemOut_Y0;

    /* End of SystemInitialize for SubSystem: '<S1>/CouplerSystem' */
  }

  /* End of SystemInitialize for SubSystem: '<Root>/CouplingSystemPerCar' */
}

/* Start for referenced model: 'CouplingSystem' */
void CouplingSystem_Start(B_CouplingSystem_c_T *localB, DW_CouplingSystem_f_T
  *localDW)
{
  /* local scratch DWork variables */
  int32_T ForEachVehicle_itr;
  int32_T ForEachVehicle_itr_i;
  int32_T ForEachCoupler_itr_e;
  static const BD_CouplingSystem_Out_Vehicle tmp = { { { { { 0.0,/* MechanicalCouplerState */
            0.0,                       /* PneumaticCouplerState */
            0.0                        /* CouplerDamaged */
          },                           /* PhysicalSignals */
          { 0.0,                       /* CouplerType */
            0.0,                       /* ReadyToCouple */
            0.0,                       /* MechanicallyCoupled */
            0.0,                       /* CouplerBrakeDemand */
            0.0,                       /* ElectricallyCoupled */
            0.0,                       /* PneumaticallyCoupled */
            false                      /* RescueModeCondition */
          }                            /* CouplingInterface */
        }, { { 0.0,                    /* MechanicalCouplerState */
            0.0,                       /* PneumaticCouplerState */
            0.0                        /* CouplerDamaged */
          },                           /* PhysicalSignals */
          { 0.0,                       /* CouplerType */
            0.0,                       /* ReadyToCouple */
            0.0,                       /* MechanicallyCoupled */
            0.0,                       /* CouplerBrakeDemand */
            0.0,                       /* ElectricallyCoupled */
            0.0,                       /* PneumaticallyCoupled */
            false                      /* RescueModeCondition */
          }                            /* CouplingInterface */
        } }                            /* Coupler */
    },                                 /* Couplers */
    { 0.0,                             /* MechanicalCouple */
      0.0                              /* MechanicalUncouple */
    },                                 /* CouplerAudio */
    { 0.0,                             /* MechanicalCouplerState */
      0.0                              /* ExternalCoupling */
    },                                 /* OutputControlStates */
    { 0.0,                             /* EPVState */
      0.0,                             /* ElectricalHeadCommand */
      0.0,                             /* MainResPressureOk */
      { 0.0, 0.0 },                    /* PneuUncouplingCommand */
      { 0.0, 0.0 },                    /* MechUncouplingCommand */
      { 0.0, 0.0 },                    /* ElectUncouplingCommand */
      { 0.0, 0.0 },                    /* ElectCouplingCommand */
      { 0.0, 0.0 },                    /* VehicleOnAnEnd */
      { 0.0, 0.0 },                    /* CouplerTypesAcrossUnit */
      { { 0.0,                         /* AutoCouple */
          0.0,                         /* AvailableReady */
          0.0,                         /* OurCoupled */
          0.0,                         /* Uncoupled */
          0.0,                         /* TheirsCoupled */
          0.0,                         /* BothCoupled */
          0.0,                         /* CouplerTypeMatched */
          0.0,                         /* TheirsExtensionRate */
          0.0,                         /* ModelledTrainCouplerType */
          0.0                          /* OtherTrainCouplerType */
        }, { 0.0,                      /* AutoCouple */
          0.0,                         /* AvailableReady */
          0.0,                         /* OurCoupled */
          0.0,                         /* Uncoupled */
          0.0,                         /* TheirsCoupled */
          0.0,                         /* BothCoupled */
          0.0,                         /* CouplerTypeMatched */
          0.0,                         /* TheirsExtensionRate */
          0.0,                         /* ModelledTrainCouplerType */
          0.0                          /* OtherTrainCouplerType */
        } }                            /* DebugPerCoupler */
    },                                 /* Debug */
    { { 0.0,                           /* MechanicalCouplerState */
        0.0,                           /* PneumaticCouplerState */
        0.0                            /* CouplerDamaged */
      }, { 0.0,                        /* MechanicalCouplerState */
        0.0,                           /* PneumaticCouplerState */
        0.0                            /* CouplerDamaged */
      } },                             /* PhysicalSignals */
    0.0,                               /* ElectricalTrainConnection */
    0.0,                               /* ElectricalUnitConnection */
    0.0                                /* ElectricalCoupledCabsConnection */
  };

  /* Start for Iterator SubSystem: '<Root>/CouplingSystemPerCar' */
  for (ForEachVehicle_itr_i = 0; ForEachVehicle_itr_i < 8; ForEachVehicle_itr_i
       ++) {
    /* Start for Enabled SubSystem: '<S1>/CouplerSystem' */
    localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS[0] = 0.0;
    localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_h[0] = 0.0;
    localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_o[0] = 0.0;
    localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_l[0] = 0.0;
    localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS[1] = 0.0;
    localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_h[1] = 0.0;
    localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_o[1] = 0.0;
    localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_l[1] = 0.0;
    localB->CoreSubsys[ForEachVehicle_itr_i].BusAssignment = tmp;

    /* Start for Iterator SubSystem: '<S4>/PerEachHeadAndTailCouperGeneralCoupling' */
    for (ForEachCoupler_itr_e = 0; ForEachCoupler_itr_e < 2;
         ForEachCoupler_itr_e++) {
      localDW->CoreSubsys[ForEachVehicle_itr_i].CoreSubsys[ForEachCoupler_itr_e]
        .DelayInput1_DSTATE = 0.0;

      /* Start for Atomic SubSystem: '<S9>/TriggerOtherCoupling' */
      localDW->CoreSubsys[ForEachVehicle_itr_i].CoreSubsys[ForEachCoupler_itr_e]
        .Timer_DSTATE = 0.0;

      /* End of Start for SubSystem: '<S9>/TriggerOtherCoupling' */
    }

    /* End of Start for SubSystem: '<S4>/PerEachHeadAndTailCouperGeneralCoupling' */

    /* Start for Atomic SubSystem: '<S8>/LeadingEdgePulse' */
    localDW->CoreSubsys[ForEachVehicle_itr_i].DelayInput1_DSTATE_n = 0.0;

    /* Start for Atomic SubSystem: '<S25>/TimerOffDelay NoInit' */
    CouplingSystem_TimerOffDelayNoInit_Start(&localB->
      CoreSubsys[ForEachVehicle_itr_i].TimerOffDelayNoInit, &localDW->
      CoreSubsys[ForEachVehicle_itr_i].TimerOffDelayNoInit);

    /* End of Start for SubSystem: '<S25>/TimerOffDelay NoInit' */
    /* End of Start for SubSystem: '<S8>/LeadingEdgePulse' */

    /* Start for Atomic SubSystem: '<S8>/TrailingEdgePulse' */
    localDW->CoreSubsys[ForEachVehicle_itr_i].DelayInput1_DSTATE = 0.0;

    /* Start for Atomic SubSystem: '<S28>/TimerOffDelay NoInit' */
    CouplingSystem_TimerOffDelayNoInit_Start(&localB->
      CoreSubsys[ForEachVehicle_itr_i].TimerOffDelayNoInit_f,
      &localDW->CoreSubsys[ForEachVehicle_itr_i].TimerOffDelayNoInit_f);

    /* End of Start for SubSystem: '<S28>/TimerOffDelay NoInit' */
    /* End of Start for SubSystem: '<S8>/TrailingEdgePulse' */
    /* End of Start for SubSystem: '<S1>/CouplerSystem' */
  }

  /* End of Start for SubSystem: '<Root>/CouplingSystemPerCar' */
}

/* Output and update for referenced model: 'CouplingSystem' */
void CouplingSystem(RT_MODEL_CouplingSystem_T * const CouplingSystem_M, const
                    BD_CouplingSystem_Cfg_Vehicle rtu_CouplingVehicleConfig[8],
                    const BD_CouplingSystem_In_Vehicle rtu_CouplingInput[8],
                    BD_CouplingSystem_Out_Vehicle rty_CouplingOutput[8],
                    B_CouplingSystem_c_T *localB, DW_CouplingSystem_f_T *localDW)
{
  /* local block i/o variables */
  boolean_T rtb_LogicalOperator_c;
  boolean_T rtb_FixPtRelationalOperator;
  boolean_T rtb_FixPtRelationalOperator_e;

  /* local scratch DWork variables */
  int32_T ForEachVehicle_itr;
  int32_T ForEachCoupler_itr;
  int32_T ForEachVehicle_itr_b;
  int32_T ForEachVehicle_itr_i;
  int32_T ForEachCoupler_itr_e;
  real_T rtb_Step;
  boolean_T rtb_FirstAndLastCoupler[16];
  boolean_T rtb_Uncouple;
  real_T rtb_AssignReady[2];
  real_T rtb_DataTypeConversion1;
  boolean_T rtb_Compare_d;
  boolean_T rtb_TheirsCoupled;
  boolean_T rtb_LogicalOperator39;
  real_T rtb_AssignReady_g[2];
  BD_CouplingSystem_Out_Vehicle_Debug_PerCoupler
    rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[2];
  BD_CouplingSystem_Out_Vehicle_SingleCoupler
    rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[2];
  boolean_T rtb_u;
  boolean_T rtb_AvailableReady;
  boolean_T rtb_CouplerTypeMatched;
  boolean_T rtb_LogicalOperator40_k2;
  boolean_T rtb_CanAutocouple;
  boolean_T rtb_LogicalOperator40_i;
  boolean_T rtb_LogicalOperator40_a;
  int32_T i;
  boolean_T rtb_NOT_idx_1;
  boolean_T rtb_NOT_idx_0;
  boolean_T rtb_Compare_h_tmp;

  /* Step: '<Root>/Step' */
  if ((( rtmGetClockTick0(CouplingSystem_M) + rtmGetClockTickH0(CouplingSystem_M)*
        4294967296.0 ) * 0.05) < CouplingSystem_P.Step_Time) {
    rtb_Step = CouplingSystem_P.Step_Y0;
  } else {
    rtb_Step = CouplingSystem_P.Step_YFinal;
  }

  /* End of Step: '<Root>/Step' */

  /* Outputs for Iterator SubSystem: '<S2>/Subsystem' incorporates:
   *  ForEach: '<S62>/For Each Vehicle'
   */
  for (ForEachVehicle_itr_b = 0; ForEachVehicle_itr_b < 8; ForEachVehicle_itr_b
       ++) {
    /* ForEachSliceAssignment generated from: '<S62>/<IsLastVehicle>' incorporates:
     *  ForEachSliceSelector generated from: '<S62>/CouplingVehicleConfig'
     */
    rtb_FirstAndLastCoupler[ForEachVehicle_itr_b + 8] =
      rtu_CouplingVehicleConfig[ForEachVehicle_itr_b].IsLastVehicle;

    /* ForEachSliceAssignment generated from: '<S62>/<IsFirstVehicle>' incorporates:
     *  ForEachSliceSelector generated from: '<S62>/CouplingVehicleConfig'
     */
    rtb_FirstAndLastCoupler[ForEachVehicle_itr_b] =
      rtu_CouplingVehicleConfig[ForEachVehicle_itr_b].IsFirstVehicle;

    /* ForEachSliceAssignment generated from: '<S62>/<HasCab>' incorporates:
     *  ForEachSliceSelector generated from: '<S62>/CouplingVehicleConfig'
     */
    localB->ImpAsg_InsertedFor_HasCab_at_inport_0[ForEachVehicle_itr_b] =
      rtu_CouplingVehicleConfig[ForEachVehicle_itr_b].HasCab;
  }

  /* End of Outputs for SubSystem: '<S2>/Subsystem' */

  /* Logic: '<Root>/NOT' */
  for (i = 0; i < 16; i++) {
    localB->NOT[i] = !rtb_FirstAndLastCoupler[i];
  }

  /* End of Logic: '<Root>/NOT' */

  /* SignalConversion generated from: '<S2>/Vector Concatenate2' incorporates:
   *  Constant: '<S2>/ForUnitConnection'
   */
  localB->VectorConcatenate2[0] = CouplingSystem_P.ForUnitConnection_Value;

  /* SignalConversion generated from: '<S2>/Vector Concatenate2' */
  for (i = 0; i < 8; i++) {
    localB->VectorConcatenate2[i + 1] =
      localB->ImpAsg_InsertedFor_HasCab_at_inport_0[i];
  }

  /* End of SignalConversion generated from: '<S2>/Vector Concatenate2' */

  /* SignalConversion generated from: '<S2>/Vector Concatenate2' incorporates:
   *  Constant: '<S2>/ForUnitConnection'
   */
  localB->VectorConcatenate2[9] = CouplingSystem_P.ForUnitConnection_Value;

  /* Outputs for Iterator SubSystem: '<S2>/VehicleCouplingSystem' incorporates:
   *  ForEach: '<S63>/For Each Vehicle'
   */
  for (ForEachVehicle_itr = 0; ForEachVehicle_itr < 8; ForEachVehicle_itr++) {
    /* Outputs for Iterator SubSystem: '<S63>/ForEachCoupler' incorporates:
     *  ForEach: '<S64>/For Each Coupler'
     */
    for (ForEachCoupler_itr = 0; ForEachCoupler_itr < 1; ForEachCoupler_itr++) {
      /* ForEachSliceAssignment generated from: '<S64>/ElectricallyCoupled' incorporates:
       *  ForEachSliceSelector generated from: '<S63>/FirstAndLastCoupler'
       *  Logic: '<S64>/Logical Operator'
       */
      rtb_NOT_idx_0 = !rtb_FirstAndLastCoupler[ForEachVehicle_itr];
      rtb_NOT_idx_1 = !rtb_FirstAndLastCoupler[ForEachVehicle_itr + 8];
    }

    /* End of Outputs for SubSystem: '<S63>/ForEachCoupler' */

    /* ForEachSliceAssignment generated from: '<S63>/ElectricallyCoupledVehicle' */
    localB->
      ImpAsg_InsertedFor_ElectricallyCoupledVehicle_at_inport_0[ForEachVehicle_itr]
      = rtb_NOT_idx_0;
    localB->
      ImpAsg_InsertedFor_ElectricallyCoupledVehicle_at_inport_0[ForEachVehicle_itr
      + 8] = rtb_NOT_idx_1;

    /* ForEachSliceAssignment generated from: '<S63>/ElectricallyCoupledAtRear' */
    localB->VectorConcatenate2_h[ForEachVehicle_itr + 1] = rtb_NOT_idx_1;
  }

  /* End of Outputs for SubSystem: '<S2>/VehicleCouplingSystem' */

  /* SignalConversion generated from: '<S61>/Vector Concatenate2' incorporates:
   *  Constant: '<S61>/ForTrainConnection'
   */
  localB->VectorConcatenate2_h[0] = CouplingSystem_P.ForTrainConnection_Value;

  /* SignalConversion generated from: '<S61>/Vector Concatenate2' incorporates:
   *  Constant: '<S61>/ForTrainConnection'
   */
  localB->VectorConcatenate2_h[9] = CouplingSystem_P.ForTrainConnection_Value;

  /* Outputs for Iterator SubSystem: '<Root>/CouplingSystemPerCar' incorporates:
   *  ForEach: '<S1>/For Each Vehicle'
   */
  for (ForEachVehicle_itr_i = 0; ForEachVehicle_itr_i < 8; ForEachVehicle_itr_i
       ++) {
    /* Outputs for Enabled SubSystem: '<S1>/CouplerSystem' incorporates:
     *  EnablePort: '<S3>/Enable'
     */
    /* ForEachSliceSelector generated from: '<S1>/VehicleConfig' incorporates:
     *  Assignment: '<S11>/AssignReady'
     *  Assignment: '<S12>/AssignReady'
     *  Assignment: '<S13>/AssignReady'
     *  Assignment: '<S15>/AssignReady'
     *  Constant: '<S6>/Constant12'
     *  Constant: '<S6>/Constant2'
     *  Constant: '<S6>/Constant3'
     *  Constant: '<S6>/Constant4'
     */
    if (rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Enabled > 0.0) {
      /* Assignment: '<S10>/AssignReady' incorporates:
       *  Constant: '<S6>/Constant1'
       */
      rtb_AssignReady[0] = CouplingSystem_P.CoreSubsys.Constant1_Value_jn[0];

      /* Logic: '<S3>/NOT' incorporates:
       *  ForEachSliceSelector generated from: '<S1>/InitCoupler'
       */
      rtb_NOT_idx_0 = !localB->NOT[ForEachVehicle_itr_i];

      /* Assignment: '<S10>/AssignReady' incorporates:
       *  Constant: '<S6>/Constant1'
       */
      rtb_AssignReady[1] = CouplingSystem_P.CoreSubsys.Constant1_Value_jn[1];

      /* Logic: '<S3>/NOT' incorporates:
       *  ForEachSliceSelector generated from: '<S1>/InitCoupler'
       */
      rtb_NOT_idx_1 = !localB->NOT[ForEachVehicle_itr_i + 8];

      /* Assignment: '<S10>/AssignReady' incorporates:
       *  Constant: '<S10>/Constant'
       *  Constant: '<S10>/Constant1'
       *  Constant: '<S17>/Constant'
       *  Constant: '<S6>/Temporary_ReadyToCouple'
       *  RelationalOperator: '<S17>/Compare'
       *  Switch: '<S10>/Switch'
       */
      if (rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Orientation <
          CouplingSystem_P.CoreSubsys.CompareToConstant_const) {
        rtb_DataTypeConversion1 = CouplingSystem_P.CoreSubsys.Constant_Value_d;
      } else {
        rtb_DataTypeConversion1 = CouplingSystem_P.CoreSubsys.Constant1_Value_f;
      }

      rtb_AssignReady[static_cast<int32_T>(rtb_DataTypeConversion1) - 1] =
        CouplingSystem_P.CoreSubsys.Temporary_ReadyToCouple_Value;

      /* Switch: '<S10>/Override if DMS' incorporates:
       *  Constant: '<S6>/Constant1'
       */
      if (rtb_NOT_idx_0) {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS[0] =
          rtb_AssignReady[0];
      } else {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS[0] =
          CouplingSystem_P.CoreSubsys.Constant1_Value_jn[0];
      }

      rtb_AssignReady[0] = CouplingSystem_P.CoreSubsys.Constant2_Value[0];

      /* Switch: '<S10>/Override if DMS' incorporates:
       *  Assignment: '<S11>/AssignReady'
       *  Constant: '<S6>/Constant1'
       *  Constant: '<S6>/Constant2'
       */
      if (rtb_NOT_idx_1) {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS[1] =
          rtb_AssignReady[1];
      } else {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS[1] =
          CouplingSystem_P.CoreSubsys.Constant1_Value_jn[1];
      }

      rtb_AssignReady[1] = CouplingSystem_P.CoreSubsys.Constant2_Value[1];

      /* Assignment: '<S11>/AssignReady' incorporates:
       *  Constant: '<S11>/Constant'
       *  Constant: '<S11>/Constant1'
       *  Constant: '<S18>/Constant'
       *  Constant: '<S6>/Constant2'
       *  DataTypeConversion: '<S6>/Data Type Conversion2'
       *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
       *  RelationalOperator: '<S18>/Compare'
       *  Switch: '<S11>/Switch'
       */
      if (rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Orientation <
          CouplingSystem_P.CoreSubsys.CompareToConstant_const_j) {
        rtb_DataTypeConversion1 = CouplingSystem_P.CoreSubsys.Constant_Value_f;
      } else {
        rtb_DataTypeConversion1 = CouplingSystem_P.CoreSubsys.Constant1_Value_c;
      }

      rtb_AssignReady[static_cast<int32_T>(rtb_DataTypeConversion1) - 1] =
        rtu_CouplingInput[ForEachVehicle_itr_i].ReleaseCoupler;

      /* Switch: '<S11>/Override if DMS' incorporates:
       *  Constant: '<S6>/Constant2'
       */
      if (rtb_NOT_idx_0) {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_h[0] =
          rtb_AssignReady[0];
      } else {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_h[0] =
          CouplingSystem_P.CoreSubsys.Constant2_Value[0];
      }

      rtb_AssignReady[0] = CouplingSystem_P.CoreSubsys.Constant3_Value[0];

      /* Switch: '<S11>/Override if DMS' incorporates:
       *  Assignment: '<S12>/AssignReady'
       *  Constant: '<S6>/Constant2'
       *  Constant: '<S6>/Constant3'
       */
      if (rtb_NOT_idx_1) {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_h[1] =
          rtb_AssignReady[1];
      } else {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_h[1] =
          CouplingSystem_P.CoreSubsys.Constant2_Value[1];
      }

      rtb_AssignReady[1] = CouplingSystem_P.CoreSubsys.Constant3_Value[1];

      /* Assignment: '<S12>/AssignReady' incorporates:
       *  Constant: '<S12>/Constant'
       *  Constant: '<S12>/Constant1'
       *  Constant: '<S19>/Constant'
       *  Constant: '<S6>/Constant3'
       *  DataTypeConversion: '<S6>/Data Type Conversion3'
       *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
       *  RelationalOperator: '<S19>/Compare'
       *  Switch: '<S12>/Switch'
       */
      if (rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Orientation <
          CouplingSystem_P.CoreSubsys.CompareToConstant_const_a) {
        rtb_DataTypeConversion1 = CouplingSystem_P.CoreSubsys.Constant_Value_k;
      } else {
        rtb_DataTypeConversion1 = CouplingSystem_P.CoreSubsys.Constant1_Value_g;
      }

      rtb_AssignReady[static_cast<int32_T>(rtb_DataTypeConversion1) - 1] =
        rtu_CouplingInput[ForEachVehicle_itr_i].ReleaseCoupler;

      /* Selector: '<S16>/Selector' incorporates:
       *  Saturate: '<S16>/Saturation'
       */
      if (rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Orientation >
          CouplingSystem_P.CoreSubsys.Saturation_UpperSat) {
        rtb_DataTypeConversion1 =
          CouplingSystem_P.CoreSubsys.Saturation_UpperSat;
      } else if (rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Orientation <
                 CouplingSystem_P.CoreSubsys.Saturation_LowerSat) {
        rtb_DataTypeConversion1 =
          CouplingSystem_P.CoreSubsys.Saturation_LowerSat;
      } else {
        rtb_DataTypeConversion1 = rtu_CouplingVehicleConfig[ForEachVehicle_itr_i]
          .Orientation;
      }

      /* Logic: '<S24>/Logical Operator39' incorporates:
       *  Logic: '<S16>/Logical Operator1'
       *  Logic: '<S24>/Logical Operator40'
       *  Memory: '<S24>/Memory'
       *  Selector: '<S16>/Selector'
       *  UnitDelay: '<S4>/Unit Delay'
       */
      rtb_LogicalOperator39 = (localDW->CoreSubsys[ForEachVehicle_itr_i].
        Memory_PreviousInput && (localDW->CoreSubsys[ForEachVehicle_itr_i].
        UnitDelay_DSTATE[static_cast<int32_T>(rtb_DataTypeConversion1) - 1].
        PhysicalSignals.MechanicalCouplerState != 0.0));

      /* Switch: '<S12>/Override if DMS' incorporates:
       *  Constant: '<S6>/Constant3'
       */
      if (rtb_NOT_idx_0) {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_o[0] =
          rtb_AssignReady[0];
      } else {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_o[0] =
          CouplingSystem_P.CoreSubsys.Constant3_Value[0];
      }

      /* Assignment: '<S14>/AssignReady' incorporates:
       *  Constant: '<S6>/Constant6'
       */
      rtb_AssignReady_g[0] = CouplingSystem_P.CoreSubsys.Constant6_Value[0];
      rtb_AssignReady[0] = CouplingSystem_P.CoreSubsys.Constant4_Value[0];

      /* Switch: '<S12>/Override if DMS' incorporates:
       *  Assignment: '<S13>/AssignReady'
       *  Constant: '<S6>/Constant3'
       *  Constant: '<S6>/Constant4'
       */
      if (rtb_NOT_idx_1) {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_o[1] =
          rtb_AssignReady[1];
      } else {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_o[1] =
          CouplingSystem_P.CoreSubsys.Constant3_Value[1];
      }

      /* Assignment: '<S14>/AssignReady' incorporates:
       *  Constant: '<S6>/Constant6'
       */
      rtb_AssignReady_g[1] = CouplingSystem_P.CoreSubsys.Constant6_Value[1];
      rtb_AssignReady[1] = CouplingSystem_P.CoreSubsys.Constant4_Value[1];

      /* Assignment: '<S13>/AssignReady' incorporates:
       *  Constant: '<S13>/Constant'
       *  Constant: '<S13>/Constant1'
       *  Constant: '<S20>/Constant'
       *  Constant: '<S6>/Constant4'
       *  DataTypeConversion: '<S6>/Data Type Conversion'
       *  RelationalOperator: '<S20>/Compare'
       *  Switch: '<S13>/Switch'
       */
      if (rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Orientation <
          CouplingSystem_P.CoreSubsys.CompareToConstant_const_d) {
        rtb_DataTypeConversion1 = CouplingSystem_P.CoreSubsys.Constant_Value_kt;
      } else {
        rtb_DataTypeConversion1 = CouplingSystem_P.CoreSubsys.Constant1_Value_k;
      }

      rtb_AssignReady[static_cast<int32_T>(rtb_DataTypeConversion1) - 1] =
        rtb_LogicalOperator39;

      /* Assignment: '<S14>/AssignReady' incorporates:
       *  Constant: '<S14>/Constant'
       *  Constant: '<S14>/Constant1'
       *  Constant: '<S21>/Constant'
       *  Constant: '<S6>/Constant7'
       *  RelationalOperator: '<S21>/Compare'
       *  Switch: '<S14>/Switch'
       */
      if (rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Orientation <
          CouplingSystem_P.CoreSubsys.CompareToConstant_const_h) {
        rtb_DataTypeConversion1 = CouplingSystem_P.CoreSubsys.Constant_Value_b;
      } else {
        rtb_DataTypeConversion1 = CouplingSystem_P.CoreSubsys.Constant1_Value_j;
      }

      rtb_AssignReady_g[static_cast<int32_T>(rtb_DataTypeConversion1) - 1] =
        CouplingSystem_P.CoreSubsys.Constant7_Value;

      /* Switch: '<S14>/Override if DMS' incorporates:
       *  Constant: '<S6>/Constant6'
       */
      if (rtb_NOT_idx_0) {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_l[0] =
          rtb_AssignReady_g[0];
      } else {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_l[0] =
          CouplingSystem_P.CoreSubsys.Constant6_Value[0];
      }

      rtb_AssignReady_g[0] = CouplingSystem_P.CoreSubsys.Constant12_Value[0];

      /* Switch: '<S14>/Override if DMS' incorporates:
       *  Assignment: '<S15>/AssignReady'
       *  Constant: '<S6>/Constant12'
       *  Constant: '<S6>/Constant6'
       */
      if (rtb_NOT_idx_1) {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_l[1] =
          rtb_AssignReady_g[1];
      } else {
        localB->CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_l[1] =
          CouplingSystem_P.CoreSubsys.Constant6_Value[1];
      }

      rtb_AssignReady_g[1] = CouplingSystem_P.CoreSubsys.Constant12_Value[1];

      /* Assignment: '<S15>/AssignReady' incorporates:
       *  Constant: '<S15>/Constant'
       *  Constant: '<S15>/Constant1'
       *  Constant: '<S22>/Constant'
       *  Constant: '<S6>/Constant12'
       *  DataTypeConversion: '<S6>/Data Type Conversion1'
       *  Memory: '<S23>/Memory'
       *  RelationalOperator: '<S22>/Compare'
       *  Switch: '<S15>/Switch'
       */
      if (rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Orientation <
          CouplingSystem_P.CoreSubsys.CompareToConstant_const_dg) {
        rtb_DataTypeConversion1 = CouplingSystem_P.CoreSubsys.Constant_Value_a;
      } else {
        rtb_DataTypeConversion1 = CouplingSystem_P.CoreSubsys.Constant1_Value_p;
      }

      rtb_AssignReady_g[static_cast<int32_T>(rtb_DataTypeConversion1) - 1] =
        localDW->CoreSubsys[ForEachVehicle_itr_i].Memory_PreviousInput_h;

      /* Outputs for Iterator SubSystem: '<S4>/PerEachHeadAndTailCouperGeneralCoupling' incorporates:
       *  ForEach: '<S9>/For Each Coupler'
       */
      for (ForEachCoupler_itr_e = 0; ForEachCoupler_itr_e < 2;
           ForEachCoupler_itr_e++) {
        /* RelationalOperator: '<S44>/Compare' incorporates:
         *  Constant: '<S44>/Constant'
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/DynamicOutCouplers'
         */
        rtb_TheirsCoupled = (rtu_CouplingInput[ForEachVehicle_itr_i].
                             DynamicsCouplers[ForEachCoupler_itr_e].Extension <=
                             CouplingSystem_P.CoreSubsys.CoreSubsys.CloseRange_const);

        /* RelationalOperator: '<S48>/Compare' incorporates:
         *  Constant: '<S48>/Constant'
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/CouplerFromOtherTrain'
         */
        rtb_Compare_d = (rtu_CouplingInput[ForEachVehicle_itr_i]
                         .Coupler[ForEachCoupler_itr_e].
                         CouplingPhysical.Interfacing ==
                         CouplingSystem_P.CoreSubsys.CoreSubsys.Constant_Value_n);

        /* Logic: '<S37>/Both Ready' incorporates:
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/CouplerFromOtherTrain'
         *  ForEachSliceSelector generated from: '<S9>/ModelledTrainReadyToCouple'
         *  Logic: '<S37>/If not interfacing assume Other is ready '
         */
        rtb_u = ((localB->CoreSubsys[ForEachVehicle_itr_i]
                  .OverrideifDMS[ForEachCoupler_itr_e] != 0.0) && (rtb_Compare_d
                  || (rtu_CouplingInput[ForEachVehicle_itr_i]
                      .Coupler[ForEachCoupler_itr_e].
                      CouplingInterface.ReadyToCouple != 0.0)));

        /* Logic: '<S37>/Coupling is Available and Both are Ready' incorporates:
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/CouplerFromOtherTrain'
         */
        rtb_AvailableReady = ((rtu_CouplingInput[ForEachVehicle_itr_i]
          .Coupler[ForEachCoupler_itr_e].CouplingPhysical.Available != 0.0) &&
                              rtb_TheirsCoupled && rtb_u);

        /* Logic: '<S37>/If not interfacing assume Other has compatible' incorporates:
         *  Constant: '<S53>/Constant'
         *  Constant: '<S54>/Constant'
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/CouplerFromOtherTrain'
         *  ForEachSliceSelector generated from: '<S9>/CouplerType'
         *  Logic: '<S47>/Logical Operator'
         *  RelationalOperator: '<S47>/Relational Operator'
         *  RelationalOperator: '<S53>/Compare'
         *  RelationalOperator: '<S54>/Compare'
         */
        rtb_CouplerTypeMatched = (((localB->CoreSubsys[ForEachVehicle_itr_i].
          OverrideifDMS_l[ForEachCoupler_itr_e] >
          CouplingSystem_P.CoreSubsys.CoreSubsys.Constant_Value_i) &&
          (localB->CoreSubsys[ForEachVehicle_itr_i]
           .OverrideifDMS_l[ForEachCoupler_itr_e] ==
           rtu_CouplingInput[ForEachVehicle_itr_i].Coupler[ForEachCoupler_itr_e]
           .CouplingInterface.CouplerType) &&
          (rtu_CouplingInput[ForEachVehicle_itr_i].Coupler[ForEachCoupler_itr_e]
           .CouplingInterface.CouplerType >
           CouplingSystem_P.CoreSubsys.CoreSubsys.Constant_Value_o)) ||
          rtb_Compare_d);

        /* Gain: '<S43>/ApproachSpeed' incorporates:
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/DynamicOutCouplers'
         */
        rtb_DataTypeConversion1 =
          CouplingSystem_P.CoreSubsys.CoreSubsys.ApproachSpeed_Gain *
          rtu_CouplingInput[ForEachVehicle_itr_i]
          .DynamicsCouplers[ForEachCoupler_itr_e].ExtensionRate;

        /* Logic: '<S52>/Logical Operator40' incorporates:
         *  Constant: '<S37>/MaxAutoCouplingSpeed'
         *  Logic: '<S43>/AND'
         *  Logic: '<S52>/Logical Operator39'
         *  Memory: '<S52>/Memory'
         *  RelationalOperator: '<S43>/TooFast'
         */
        rtb_LogicalOperator40_k2 = (((rtb_DataTypeConversion1 >
          CouplingSystem_P.CoreSubsys.CoreSubsys.MaxAutoCouplingSpeed_Value) &&
          rtb_TheirsCoupled) || localDW->CoreSubsys[ForEachVehicle_itr_i].
          CoreSubsys[ForEachCoupler_itr_e].Memory_PreviousInput);

        /* Logic: '<S43>/CanAutocouple' incorporates:
         *  Constant: '<S37>/MaxAutoCouplingSpeed'
         *  Constant: '<S37>/MinAutoCouplingSpeed'
         *  Logic: '<S43>/NotTooFast'
         *  Logic: '<S51>/FixPt Logical Operator'
         *  RelationalOperator: '<S51>/Lower Test'
         *  RelationalOperator: '<S51>/Upper Test'
         */
        rtb_CanAutocouple = (rtb_CouplerTypeMatched &&
                             ((CouplingSystem_P.CoreSubsys.CoreSubsys.MinAutoCouplingSpeed_Value
          <= rtb_DataTypeConversion1) && (rtb_DataTypeConversion1 <=
          CouplingSystem_P.CoreSubsys.CoreSubsys.MaxAutoCouplingSpeed_Value)) &&
                             (!rtb_LogicalOperator40_k2));

        /* Logic: '<S37>/Uncouple' incorporates:
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/CouplerFromOtherTrain'
         *  ForEachSliceSelector generated from: '<S9>/DynamicOutCouplers'
         *  ForEachSliceSelector generated from: '<S9>/MechUncoupleCommand'
         *  RelationalOperator: '<S46>/FixPt Relational Operator'
         *  UnitDelay: '<S46>/Delay Input1'
         */
        rtb_Uncouple = ((localB->CoreSubsys[ForEachVehicle_itr_i].
                         OverrideifDMS_h[ForEachCoupler_itr_e] != 0.0) ||
                        (rtu_CouplingInput[ForEachVehicle_itr_i].
                         DynamicsCouplers[ForEachCoupler_itr_e].Breakage != 0.0)
                        || (rtu_CouplingInput[ForEachVehicle_itr_i]
                            .Coupler[ForEachCoupler_itr_e].
                            CouplingInterface.MechanicallyCoupled <
                            localDW->CoreSubsys[ForEachVehicle_itr_i]
                            .CoreSubsys[ForEachCoupler_itr_e].DelayInput1_DSTATE));

        /* Switch: '<S37>/Switch' incorporates:
         *  ForEachSliceSelector generated from: '<S9>/InitCoupler'
         *  Logic: '<S37>/AutoCouple'
         */
        if (rtb_Step > CouplingSystem_P.CoreSubsys.CoreSubsys.Switch_Threshold)
        {
          rtb_LogicalOperator40_a = localB->NOT[(ForEachCoupler_itr_e << 3) +
            ForEachVehicle_itr_i];
        } else {
          rtb_LogicalOperator40_a = (rtb_AvailableReady && rtb_CanAutocouple);
        }

        /* End of Switch: '<S37>/Switch' */

        /* Logic: '<S45>/Logical Operator40' incorporates:
         *  Logic: '<S45>/Logical Operator39'
         *  Logic: '<S45>/Logical Operator41'
         *  Memory: '<S45>/Memory'
         */
        rtb_LogicalOperator40_i = ((rtb_LogicalOperator40_a ||
          localDW->CoreSubsys[ForEachVehicle_itr_i]
          .CoreSubsys[ForEachCoupler_itr_e].Memory_PreviousInput_e) &&
          (!rtb_Uncouple));

        /* Logic: '<S37>/If not interfacing assume Other has alway MechCoupled' incorporates:
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/CouplerFromOtherTrain'
         */
        rtb_TheirsCoupled = (rtb_Compare_d ||
                             (rtu_CouplingInput[ForEachVehicle_itr_i]
                              .Coupler[ForEachCoupler_itr_e].
                              CouplingInterface.MechanicallyCoupled != 0.0));

        /* Logic: '<S37>/BothCoupled' */
        rtb_Compare_h_tmp = (rtb_LogicalOperator40_i && rtb_TheirsCoupled);

        /* Outputs for Atomic SubSystem: '<S9>/TriggerOtherCoupling' */
        /* Logic: '<S38>/Logical Operator' incorporates:
         *  Logic: '<S37>/BothCoupled'
         */
        rtb_LogicalOperator_c = !rtb_Compare_h_tmp;

        /* DiscreteIntegrator: '<S38>/Timer' incorporates:
         *  DataTypeConversion: '<S37>/Data Type Conversion1'
         *  Logic: '<S37>/BothCoupled'
         */
        if (rtb_LogicalOperator_c || (localDW->CoreSubsys[ForEachVehicle_itr_i].
             CoreSubsys[ForEachCoupler_itr_e].Timer_PrevResetState != 0)) {
          localDW->CoreSubsys[ForEachVehicle_itr_i]
            .CoreSubsys[ForEachCoupler_itr_e].Timer_DSTATE =
            CouplingSystem_P.CoreSubsys.CoreSubsys.Timer_IC;
        }

        rtb_DataTypeConversion1 =
          CouplingSystem_P.CoreSubsys.CoreSubsys.Timer_gainval *
          static_cast<real_T>(rtb_Compare_h_tmp) + localDW->
          CoreSubsys[ForEachVehicle_itr_i].CoreSubsys[ForEachCoupler_itr_e].
          Timer_DSTATE;
        if (rtb_DataTypeConversion1 >=
            CouplingSystem_P.CoreSubsys.CoreSubsys.TriggerOtherCoupling_UpperSaturationLimit)
        {
          rtb_DataTypeConversion1 =
            CouplingSystem_P.CoreSubsys.CoreSubsys.TriggerOtherCoupling_UpperSaturationLimit;
          i = 1;
        } else if (rtb_DataTypeConversion1 <=
                   CouplingSystem_P.CoreSubsys.CoreSubsys.Timer_LowerSat) {
          rtb_DataTypeConversion1 =
            CouplingSystem_P.CoreSubsys.CoreSubsys.Timer_LowerSat;
          i = -1;
        } else {
          i = 0;
        }

        /* End of DiscreteIntegrator: '<S38>/Timer' */

        /* Update for DiscreteIntegrator: '<S38>/Timer' */
        localDW->CoreSubsys[ForEachVehicle_itr_i]
          .CoreSubsys[ForEachCoupler_itr_e].Timer_DSTATE =
          rtb_DataTypeConversion1;
        localDW->CoreSubsys[ForEachVehicle_itr_i]
          .CoreSubsys[ForEachCoupler_itr_e].Timer_PrevResetState =
          static_cast<int8_T>(rtb_LogicalOperator_c);

        /* End of Outputs for SubSystem: '<S9>/TriggerOtherCoupling' */

        /* Switch: '<S35>/Switch2' incorporates:
         *  Constant: '<S59>/Constant'
         *  Constant: '<S6>/Constant11'
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/CouplerFromOtherTrain'
         *  ForEachSliceSelector generated from: '<S9>/CouplerType'
         *  ForEachSliceSelector generated from: '<S9>/InitCoupler'
         *  ForEachSliceSelector generated from: '<S9>/PneuCouplingIsolation'
         *  Logic: '<S35>/Logical'
         *  Logic: '<S35>/Not Isolated'
         *  RelationalOperator: '<S35>/Relational Operator'
         *  RelationalOperator: '<S59>/Compare'
         */
        if (rtb_Step > CouplingSystem_P.CoreSubsys.CoreSubsys.Switch2_Threshold)
        {
          rtb_LogicalOperator40_a = localB->NOT[(ForEachCoupler_itr_e << 3) +
            ForEachVehicle_itr_i];
        } else {
          /* Outputs for Atomic SubSystem: '<S9>/TriggerOtherCoupling' */
          rtb_LogicalOperator40_a = ((i >
            CouplingSystem_P.CoreSubsys.CoreSubsys.Constant_Value_j) &&
            (!(CouplingSystem_P.CoreSubsys.Constant11_Value[ForEachCoupler_itr_e]
               != 0.0)) && (localB->CoreSubsys[ForEachVehicle_itr_i].
                            OverrideifDMS_l[ForEachCoupler_itr_e] ==
                            rtu_CouplingInput[ForEachVehicle_itr_i]
                            .Coupler[ForEachCoupler_itr_e].
                            CouplingInterface.CouplerType));

          /* End of Outputs for SubSystem: '<S9>/TriggerOtherCoupling' */
        }

        /* End of Switch: '<S35>/Switch2' */

        /* Logic: '<S39>/Logical Operator40' incorporates:
         *  ForEachSliceSelector generated from: '<S9>/PneuUncoupleCommand'
         *  Logic: '<S39>/Logical Operator39'
         *  Logic: '<S39>/Logical Operator41'
         *  Memory: '<S39>/Memory'
         */
        rtb_Compare_d = ((rtb_LogicalOperator40_a || localDW->
                          CoreSubsys[ForEachVehicle_itr_i]
                          .CoreSubsys[ForEachCoupler_itr_e].
                          Memory_PreviousInput_g) && (!(localB->
          CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_o[ForEachCoupler_itr_e]
          != 0.0)));

        /* Logic: '<S56>/Logical Operator40' incorporates:
         *  Constant: '<S55>/Constant'
         *  Constant: '<S57>/Constant'
         *  Constant: '<S58>/Constant'
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/DynamicOutCouplers'
         *  Logic: '<S49>/ AND'
         *  Logic: '<S56>/Logical Operator39'
         *  Logic: '<S56>/Logical Operator41'
         *  Memory: '<S56>/Memory'
         *  RelationalOperator: '<S55>/Compare'
         *  RelationalOperator: '<S57>/Compare'
         *  RelationalOperator: '<S58>/Compare'
         */
        rtb_LogicalOperator40_a = ((((rtu_CouplingInput[ForEachVehicle_itr_i].
          DynamicsCouplers[ForEachCoupler_itr_e].Extension >
          CouplingSystem_P.CoreSubsys.CoreSubsys.WithinRange_const) &&
          (rtu_CouplingInput[ForEachVehicle_itr_i]
           .DynamicsCouplers[ForEachCoupler_itr_e].Extension <
           CouplingSystem_P.CoreSubsys.CoreSubsys.WithinRange1_const)) ||
          localDW->CoreSubsys[ForEachVehicle_itr_i]
          .CoreSubsys[ForEachCoupler_itr_e].Memory_PreviousInput_a) &&
          (!(rtu_CouplingInput[ForEachVehicle_itr_i]
             .DynamicsCouplers[ForEachCoupler_itr_e].Extension >
             CouplingSystem_P.CoreSubsys.CoreSubsys.MovedAway_const)));

        /* ForEachSliceAssignment generated from: '<S9>/PerCouplerOut' incorporates:
         *  Logic: '<S49>/ '
         */
        rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[ForEachCoupler_itr_e].
          CouplingInterface.RescueModeCondition = (rtb_LogicalOperator40_a &&
          rtb_u);

        /* Update for Memory: '<S52>/Memory' */
        localDW->CoreSubsys[ForEachVehicle_itr_i]
          .CoreSubsys[ForEachCoupler_itr_e].Memory_PreviousInput =
          rtb_LogicalOperator40_k2;

        /* Update for Memory: '<S45>/Memory' */
        localDW->CoreSubsys[ForEachVehicle_itr_i]
          .CoreSubsys[ForEachCoupler_itr_e].Memory_PreviousInput_e =
          rtb_LogicalOperator40_i;

        /* Update for UnitDelay: '<S46>/Delay Input1' incorporates:
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/CouplerFromOtherTrain'
         */
        localDW->CoreSubsys[ForEachVehicle_itr_i]
          .CoreSubsys[ForEachCoupler_itr_e].DelayInput1_DSTATE =
          rtu_CouplingInput[ForEachVehicle_itr_i].Coupler[ForEachCoupler_itr_e].
          CouplingInterface.MechanicallyCoupled;

        /* Update for Memory: '<S39>/Memory' */
        localDW->CoreSubsys[ForEachVehicle_itr_i]
          .CoreSubsys[ForEachCoupler_itr_e].Memory_PreviousInput_g =
          rtb_Compare_d;

        /* Update for Memory: '<S56>/Memory' */
        localDW->CoreSubsys[ForEachVehicle_itr_i]
          .CoreSubsys[ForEachCoupler_itr_e].Memory_PreviousInput_a =
          rtb_LogicalOperator40_a;

        /* ForEachSliceAssignment generated from: '<S9>/PerCouplerOut' incorporates:
         *  BusAssignment: '<S9>/Bus Assignment1'
         *  Constant: '<S40>/Constant'
         *  Constant: '<S6>/Constant5'
         *  DataTypeConversion: '<S35>/Data Type Conversion1'
         *  DataTypeConversion: '<S35>/Data Type Conversion2'
         *  DataTypeConversion: '<S37>/Data Type Conversion'
         *  DataTypeConversion: '<S37>/Data Type Conversion1'
         *  DataTypeConversion: '<S37>/Data Type Conversion2'
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/CouplerBrakeDemand'
         *  ForEachSliceSelector generated from: '<S9>/CouplerFromOtherTrain'
         *  ForEachSliceSelector generated from: '<S9>/CouplerType'
         *  ForEachSliceSelector generated from: '<S9>/ModelledTrainReadyToCouple'
         *  Logic: '<S35>/BothCoupled'
         *  Logic: '<S35>/CoupledOrObjectDoesntExist'
         *  RelationalOperator: '<S40>/Compare'
         */
        rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[ForEachCoupler_itr_e].
          PhysicalSignals.MechanicalCouplerState = rtb_Compare_h_tmp;
        rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[ForEachCoupler_itr_e].
          PhysicalSignals.PneumaticCouplerState = (rtb_Compare_d &&
          ((rtu_CouplingInput[ForEachVehicle_itr_i].Coupler[ForEachCoupler_itr_e]
            .CouplingInterface.PneumaticallyCoupled != 0.0) ||
           (rtu_CouplingInput[ForEachVehicle_itr_i].Coupler[ForEachCoupler_itr_e]
            .CouplingPhysical.Interfacing ==
            CouplingSystem_P.CoreSubsys.CoreSubsys.Constant_Value_b)));
        rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[ForEachCoupler_itr_e].
          PhysicalSignals.CouplerDamaged = rtb_LogicalOperator40_k2;
        rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[ForEachCoupler_itr_e].
          CouplingInterface.CouplerType = localB->
          CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_l[ForEachCoupler_itr_e];
        rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[ForEachCoupler_itr_e].
          CouplingInterface.ReadyToCouple = localB->
          CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS[ForEachCoupler_itr_e];
        rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[ForEachCoupler_itr_e].
          CouplingInterface.MechanicallyCoupled = rtb_LogicalOperator40_i;
        rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[ForEachCoupler_itr_e].
          CouplingInterface.CouplerBrakeDemand =
          CouplingSystem_P.CoreSubsys.Constant5_Value[ForEachCoupler_itr_e];
        rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[ForEachCoupler_itr_e].
          CouplingInterface.ElectricallyCoupled = 0.0;
        rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[ForEachCoupler_itr_e].
          CouplingInterface.PneumaticallyCoupled = rtb_Compare_d;

        /* ForEachSliceAssignment generated from: '<S9>/DebugPerCoupler' incorporates:
         *  BusAssignment: '<S50>/Bus Assignment'
         *  DataTypeConversion: '<S37>/Data Type Conversion1'
         *  DataTypeConversion: '<S50>/Data Type Conversion'
         *  DataTypeConversion: '<S50>/Data Type Conversion1'
         *  DataTypeConversion: '<S50>/Data Type Conversion2'
         *  DataTypeConversion: '<S50>/Data Type Conversion3'
         *  DataTypeConversion: '<S50>/Data Type Conversion4'
         *  DataTypeConversion: '<S50>/Data Type Conversion6'
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         *  ForEachSliceSelector generated from: '<S9>/CouplerFromOtherTrain'
         *  ForEachSliceSelector generated from: '<S9>/CouplerType'
         *  ForEachSliceSelector generated from: '<S9>/DynamicOutCouplers'
         */
        rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[ForEachCoupler_itr_e]
          .AutoCouple = rtb_CanAutocouple;
        rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[ForEachCoupler_itr_e]
          .AvailableReady = rtb_AvailableReady;
        rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[ForEachCoupler_itr_e]
          .OurCoupled = rtb_LogicalOperator40_i;
        rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[ForEachCoupler_itr_e]
          .Uncoupled = rtb_Uncouple;
        rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[ForEachCoupler_itr_e]
          .TheirsCoupled = rtb_TheirsCoupled;
        rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[ForEachCoupler_itr_e]
          .BothCoupled = rtb_Compare_h_tmp;
        rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[ForEachCoupler_itr_e]
          .CouplerTypeMatched = rtb_CouplerTypeMatched;
        rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[ForEachCoupler_itr_e]
          .TheirsExtensionRate = rtu_CouplingInput[ForEachVehicle_itr_i].
          DynamicsCouplers[ForEachCoupler_itr_e].ExtensionRate;
        rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[ForEachCoupler_itr_e]
          .ModelledTrainCouplerType = localB->CoreSubsys[ForEachVehicle_itr_i].
          OverrideifDMS_l[ForEachCoupler_itr_e];
        rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[ForEachCoupler_itr_e]
          .OtherTrainCouplerType = rtu_CouplingInput[ForEachVehicle_itr_i].
          Coupler[ForEachCoupler_itr_e].CouplingInterface.CouplerType;
      }

      /* End of Outputs for SubSystem: '<S4>/PerEachHeadAndTailCouperGeneralCoupling' */

      /* Switch: '<S8>/Switch2' */
      if (rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Orientation >=
          CouplingSystem_P.CoreSubsys.Switch2_Threshold) {
        rtb_DataTypeConversion1 =
          rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[1].
          PhysicalSignals.MechanicalCouplerState;
      } else {
        rtb_DataTypeConversion1 =
          rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[0].
          PhysicalSignals.MechanicalCouplerState;
      }

      /* End of Switch: '<S8>/Switch2' */

      /* Outputs for Atomic SubSystem: '<S8>/LeadingEdgePulse' */
      /* RelationalOperator: '<S29>/FixPt Relational Operator' incorporates:
       *  UnitDelay: '<S29>/Delay Input1'
       */
      rtb_FixPtRelationalOperator_e = (rtb_DataTypeConversion1 >
        localDW->CoreSubsys[ForEachVehicle_itr_i].DelayInput1_DSTATE_n);

      /* Outputs for Atomic SubSystem: '<S25>/TimerOffDelay NoInit' */
      CouplingSystem_TimerOffDelayNoInit(rtb_FixPtRelationalOperator_e,
        &localB->CoreSubsys[ForEachVehicle_itr_i].TimerOffDelayNoInit,
        &localDW->CoreSubsys[ForEachVehicle_itr_i].TimerOffDelayNoInit,
        &CouplingSystem_P.CoreSubsys.TimerOffDelayNoInit);

      /* End of Outputs for SubSystem: '<S25>/TimerOffDelay NoInit' */

      /* Update for UnitDelay: '<S29>/Delay Input1' */
      localDW->CoreSubsys[ForEachVehicle_itr_i].DelayInput1_DSTATE_n =
        rtb_DataTypeConversion1;

      /* End of Outputs for SubSystem: '<S8>/LeadingEdgePulse' */

      /* Outputs for Atomic SubSystem: '<S8>/TrailingEdgePulse' */
      /* RelationalOperator: '<S32>/FixPt Relational Operator' incorporates:
       *  UnitDelay: '<S32>/Delay Input1'
       */
      rtb_FixPtRelationalOperator = (rtb_DataTypeConversion1 <
        localDW->CoreSubsys[ForEachVehicle_itr_i].DelayInput1_DSTATE);

      /* Outputs for Atomic SubSystem: '<S28>/TimerOffDelay NoInit' */
      CouplingSystem_TimerOffDelayNoInit(rtb_FixPtRelationalOperator,
        &localB->CoreSubsys[ForEachVehicle_itr_i].TimerOffDelayNoInit_f,
        &localDW->CoreSubsys[ForEachVehicle_itr_i].TimerOffDelayNoInit_f,
        &CouplingSystem_P.CoreSubsys.TimerOffDelayNoInit_f);

      /* End of Outputs for SubSystem: '<S28>/TimerOffDelay NoInit' */

      /* Update for UnitDelay: '<S32>/Delay Input1' */
      localDW->CoreSubsys[ForEachVehicle_itr_i].DelayInput1_DSTATE =
        rtb_DataTypeConversion1;

      /* End of Outputs for SubSystem: '<S8>/TrailingEdgePulse' */

      /* BusAssignment: '<S5>/Bus Assignment' incorporates:
       *  Constant: '<S5>/Constant'
       */
      localB->CoreSubsys[ForEachVehicle_itr_i].BusAssignment =
        CouplingSystem_P.CoreSubsys.Constant_Value;
      memcpy(&localB->CoreSubsys[ForEachVehicle_itr_i].
             BusAssignment.Couplers.Coupler[0],
             &rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[0], sizeof
             (BD_CouplingSystem_Out_Vehicle_SingleCoupler) << 1U);

      /* Switch: '<S26>/Switch3' */
      if (rtb_Step > CouplingSystem_P.CoreSubsys.Switch3_Threshold) {
        /* BusAssignment: '<S5>/Bus Assignment' */
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.CouplerAudio.MechanicalCouple = 0.0;
      } else {
        /* BusAssignment: '<S5>/Bus Assignment' */
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.CouplerAudio.MechanicalCouple = localB->
          CoreSubsys[ForEachVehicle_itr_i].TimerOffDelayNoInit.LogicalOperator1;
      }

      /* End of Switch: '<S26>/Switch3' */

      /* Switch: '<S27>/Switch3' */
      if (rtb_Step > CouplingSystem_P.CoreSubsys.Switch3_Threshold_o) {
        /* BusAssignment: '<S5>/Bus Assignment' */
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.CouplerAudio.MechanicalUncouple = 0.0;
      } else {
        /* BusAssignment: '<S5>/Bus Assignment' */
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.CouplerAudio.MechanicalUncouple = localB->
          CoreSubsys[ForEachVehicle_itr_i].
          TimerOffDelayNoInit_f.LogicalOperator1;
      }

      /* End of Switch: '<S27>/Switch3' */

      /* BusAssignment: '<S5>/Bus Assignment' incorporates:
       *  BusCreator: '<S8>/Bus Creator1'
       */
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.OutputControlStates.MechanicalCouplerState =
        rtb_DataTypeConversion1;

      /* Switch: '<S8>/Switch1' */
      if (rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Orientation >=
          CouplingSystem_P.CoreSubsys.Switch1_Threshold) {
        /* BusAssignment: '<S5>/Bus Assignment' incorporates:
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         */
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.OutputControlStates.ExternalCoupling =
          rtu_CouplingInput[ForEachVehicle_itr_i].DynamicsCouplers[1].
          ExternalCoupling;
      } else {
        /* BusAssignment: '<S5>/Bus Assignment' incorporates:
         *  ForEachSliceSelector generated from: '<S1>/CouplingInput'
         */
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.OutputControlStates.ExternalCoupling =
          rtu_CouplingInput[ForEachVehicle_itr_i].DynamicsCouplers[0].
          ExternalCoupling;
      }

      /* End of Switch: '<S8>/Switch1' */

      /* BusAssignment: '<S5>/Bus Assignment' incorporates:
       *  BusAssignment: '<S60>/Bus Assignment1'
       *  Constant: '<S16>/Constant'
       *  DataTypeConversion: '<S60>/Data Type Conversion1'
       *  DataTypeConversion: '<S7>/Data Type Conversion1'
       *  DataTypeConversion: '<S7>/Data Type Conversion2'
       *  ForEachSliceSelector generated from: '<S1>/CabVehicleUp'
       *  ForEachSliceSelector generated from: '<S1>/CabVehicle'
       *  ForEachSliceSelector generated from: '<S1>/VehicleElectricallyCoupled'
       *  ForEachSliceSelector generated from: '<S1>/VehicleUpElectricallyCoupledAtRear'
       *  Logic: '<S7>/AND'
       *  Logic: '<S7>/AND2'
       *  Logic: '<S7>/AND4'
       *  Logic: '<S7>/NOT1'
       *  Logic: '<S7>/NOT3'
       *  Logic: '<S7>/OR'
       *  Memory: '<S23>/Memory'
       */
      localB->CoreSubsys[ForEachVehicle_itr_i].BusAssignment.Debug.EPVState =
        0.0;
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.Debug.ElectricalHeadCommand = localDW->
        CoreSubsys[ForEachVehicle_itr_i].Memory_PreviousInput_h;
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.Debug.MainResPressureOk =
        CouplingSystem_P.CoreSubsys.Constant_Value_e;
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.ElectricalTrainConnection =
        ((rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Enabled != 0.0) &&
         (localB->
          ImpAsg_InsertedFor_ElectricallyCoupledVehicle_at_inport_0[ForEachVehicle_itr_i]
          && localB->VectorConcatenate2_h[ForEachVehicle_itr_i]));
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.ElectricalUnitConnection =
        rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].UnitConnection;
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.ElectricalCoupledCabsConnection =
        ((rtu_CouplingVehicleConfig[ForEachVehicle_itr_i].Enabled != 0.0) &&
         (localB->ImpAsg_InsertedFor_HasCab_at_inport_0[ForEachVehicle_itr_i] &&
          localB->VectorConcatenate2[ForEachVehicle_itr_i]));
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.Debug.PneuUncouplingCommand[0] = localB->
        CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_o[0];
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.Debug.MechUncouplingCommand[0] = localB->
        CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_h[0];

      /* Switch: '<S13>/Override if DMS' incorporates:
       *  Switch: '<S15>/Override if DMS'
       */
      if (rtb_NOT_idx_0) {
        /* BusAssignment: '<S5>/Bus Assignment' */
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.Debug.ElectUncouplingCommand[0] = rtb_AssignReady[0];
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.Debug.ElectCouplingCommand[0] = rtb_AssignReady_g[0];
      } else {
        /* BusAssignment: '<S5>/Bus Assignment' incorporates:
         *  Constant: '<S6>/Constant12'
         *  Constant: '<S6>/Constant4'
         */
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.Debug.ElectUncouplingCommand[0] =
          CouplingSystem_P.CoreSubsys.Constant4_Value[0];
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.Debug.ElectCouplingCommand[0] =
          CouplingSystem_P.CoreSubsys.Constant12_Value[0];
      }

      /* BusAssignment: '<S5>/Bus Assignment' incorporates:
       *  BusAssignment: '<S60>/Bus Assignment1'
       *  DataTypeConversion: '<S60>/Data Type Conversion7'
       *  Switch: '<S13>/Override if DMS'
       */
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.Debug.VehicleOnAnEnd[0] = rtb_NOT_idx_0;
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.Debug.CouplerTypesAcrossUnit[0] = localB->
        CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_l[0];
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.Debug.DebugPerCoupler[0] =
        rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[0];

      /* Update for UnitDelay: '<S4>/Unit Delay' */
      localDW->CoreSubsys[ForEachVehicle_itr_i].UnitDelay_DSTATE[0] =
        rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[0];

      /* BusAssignment: '<S5>/Bus Assignment' incorporates:
       *  BusAssignment: '<S60>/Bus Assignment1'
       */
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.Debug.PneuUncouplingCommand[1] = localB->
        CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_o[1];
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.Debug.MechUncouplingCommand[1] = localB->
        CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_h[1];

      /* Switch: '<S13>/Override if DMS' incorporates:
       *  Switch: '<S15>/Override if DMS'
       */
      if (rtb_NOT_idx_1) {
        /* BusAssignment: '<S5>/Bus Assignment' */
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.Debug.ElectUncouplingCommand[1] = rtb_AssignReady[1];
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.Debug.ElectCouplingCommand[1] = rtb_AssignReady_g[1];
      } else {
        /* BusAssignment: '<S5>/Bus Assignment' incorporates:
         *  Constant: '<S6>/Constant12'
         *  Constant: '<S6>/Constant4'
         */
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.Debug.ElectUncouplingCommand[1] =
          CouplingSystem_P.CoreSubsys.Constant4_Value[1];
        localB->CoreSubsys[ForEachVehicle_itr_i].
          BusAssignment.Debug.ElectCouplingCommand[1] =
          CouplingSystem_P.CoreSubsys.Constant12_Value[1];
      }

      /* BusAssignment: '<S5>/Bus Assignment' incorporates:
       *  BusAssignment: '<S60>/Bus Assignment1'
       *  DataTypeConversion: '<S60>/Data Type Conversion7'
       *  Switch: '<S13>/Override if DMS'
       */
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.Debug.VehicleOnAnEnd[1] = rtb_NOT_idx_1;
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.Debug.CouplerTypesAcrossUnit[1] = localB->
        CoreSubsys[ForEachVehicle_itr_i].OverrideifDMS_l[1];
      localB->CoreSubsys[ForEachVehicle_itr_i].
        BusAssignment.Debug.DebugPerCoupler[1] =
        rtb_ImpAsg_InsertedFor_DebugPerCoupler_at_inport_0[1];

      /* Update for UnitDelay: '<S4>/Unit Delay' */
      localDW->CoreSubsys[ForEachVehicle_itr_i].UnitDelay_DSTATE[1] =
        rtb_ImpAsg_InsertedFor_PerCouplerOut_at_inport_0[1];

      /* Update for Memory: '<S24>/Memory' */
      localDW->CoreSubsys[ForEachVehicle_itr_i].Memory_PreviousInput =
        rtb_LogicalOperator39;
    }

    /* End of ForEachSliceSelector generated from: '<S1>/VehicleConfig' */
    /* End of Outputs for SubSystem: '<S1>/CouplerSystem' */

    /* ForEachSliceAssignment generated from: '<S1>/CouplingOutput' */
    rty_CouplingOutput[ForEachVehicle_itr_i] = localB->
      CoreSubsys[ForEachVehicle_itr_i].BusAssignment;
  }

  /* End of Outputs for SubSystem: '<Root>/CouplingSystemPerCar' */
}

/* Model initialize function */
void CouplingSystem_initialize(const char_T **rt_errorStatus, const
  rtTimingBridge *timingBridge, int_T mdlref_TID0, RT_MODEL_CouplingSystem_T *
  const CouplingSystem_M, B_CouplingSystem_c_T *localB, DW_CouplingSystem_f_T
  *localDW, rtwCAPI_ModelMappingInfo *rt_ParentMMI, const char_T *rt_ChildPath,
  int_T rt_ChildMMIIdx, int_T rt_CSTATEIdx)
{
  /* Registration code */

  /* setup the global timing engine */
  CouplingSystem_M->Timing.mdlref_GlobalTID[0] = mdlref_TID0;
  CouplingSystem_M->timingBridge = (timingBridge);

  /* initialize error status */
  rtmSetErrorStatusPointer(CouplingSystem_M, rt_errorStatus);

  /* block I/O */
  (void) memset((static_cast<void *>(localB)), 0,
                sizeof(B_CouplingSystem_c_T));

  /* states (dwork) */
  (void) memset(static_cast<void *>(localDW), 0,
                sizeof(DW_CouplingSystem_f_T));

  /* Initialize DataMapInfo substructure containing ModelMap for C API */
  {
    CouplingSystem_InitializeDataMapInfo(CouplingSystem_M, localB);
  }

  /* Initialize Parent model MMI */
  if ((rt_ParentMMI != (NULL)) && (rt_ChildPath != (NULL))) {
    rtwCAPI_SetChildMMI(*rt_ParentMMI, rt_ChildMMIIdx,
                        &(CouplingSystem_M->DataMapInfo.mmi));
    rtwCAPI_SetPath(CouplingSystem_M->DataMapInfo.mmi, rt_ChildPath);
    rtwCAPI_MMISetContStateStartIndex(CouplingSystem_M->DataMapInfo.mmi,
      rt_CSTATEIdx);
  }
}
